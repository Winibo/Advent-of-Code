This is almost certainly broken in some way, but it works on my input so, meh
